{% extends "basic.html" %}

{% block content %}
<div class="row">
    <div class="col-sm-7 product_images">
        <div class="imgBox"><img src="{{MEDIA_URL}}{{product.image0}}" alt=""></div>
        <ul class="thumb">
            {% if product.image0 %}
            <li><a href="{{MEDIA_URL}}{{product.image0}}" target="imgBox"><img src="{{MEDIA_URL}}{{product.image0}}"
                        alt="thumb"></a></li>
            {% endif %}</li>

            {% if product.image1 %}
            <li><a href="{{MEDIA_URL}}{{product.image1}}" target="imgBox"><img src="{{MEDIA_URL}}{{product.image1}}"
                        alt="thumb"></a></li>
            {% endif %}
            {% if product.image2 %}
            <li><a href="{{MEDIA_URL}}{{product.image2}}" target="imgBox"><img src="{{MEDIA_URL}}{{product.image2}}"
                        alt="thumb"></a></li>
            {% endif %}
            {% if product.image3 %}
            <li><a href="{{MEDIA_URL}}{{product.image3}}" target="imgBox"><img src="{{MEDIA_URL}}{{product.image3}}"
                        alt="thumb"></a></li>
            {% endif %}

        </ul>
    </div>
    <div class="col-sm-5 ">
    <div class="tab">
            <button class="tablinks" onclick="openTab('product')">Описание</button>
            <button class="tablinks" onclick="openTab('reviews')">Отзывы</button>
            {% if product.rating <= 1 %}
                <p class="rating rating_low">{{product.rating|floatformat:2}}</p>
            {% elif product.rating > 1 and product.rating < 4.5%}
                <p class="rating rating_mid">{{product.rating|floatformat:2}}</p>
            {% else %}
                <p class="rating rating_high">{{product.rating|floatformat:2}}</p>
            {% endif %}
            
        </div>
        <div class="product" id="product">
            <h2 class="product_title">{{ product.title }}</h2>
            <p class="product_price">{{ product.price }}&#8381;</p><br> <br>
            {% if product.description %}<span class="product_info"></span>
            <p class="product_description"> {{product.description}}</p>{% endif %}
            {% if product.size %}<span class="product_info">Размер: </span>
            <p> {{product.size}}</p>{% endif %}
            {% if product.material %}<span class="product_info">Материал: </span>
            <p> {{product.material}}</p>{% endif %}
            {% if product.articul %}<span class="product_info">Артикул: </span>
            <p>{{product.articul}}</p>{% endif %}
            {% if product in user.profile.ebooks.all %}
            <a href="{% url 'shopping_cart:order_summary' %}" class="add_to_cart_button cart_button">Уже в корзине</a>
            {% else %}
            <a href="{% url 'shopping_cart:add_to_cart' product.id %}" class="add_to_cart_button">В корзину</a>
            {% endif %}
        </div>
        <div class="reviews tabcontent" id="reviews">

            <div class="all_revs">
            {% for obj in reviews %}
                <div class="rev">
                    <p><b class="author">{{obj.author.user.username}}</b> 
                    {% if obj.rate <= 1 %}
                        <p class="rate rating_low">{{obj.rate|floatformat:2}}</p>
                    {% elif obj.rate > 1 and obj.rate < 4.5%}
                        <p class="rate rating_mid">{{obj.rate|floatformat:2}}</p>
                    {% else %}
                        <p class="rate rating_high">{{obj.rate|floatformat:2}}</p>
                    {% endif %}
                    {% if request.user.username ==  obj.author.user.username%}
                    <a href="/upd_rev/{{obj.product.id}}/{{obj.id}}">Изменить</a>
                        <a href="/del_rev/{{product.id}}/{{obj.id}}">Удалить</a>
                    {% endif %}
                        
                     
                    <br><p class="text">{{obj.text}}</p>
                </div>
            {% endfor %}
            </div>
            {% if user.is_authenticated %}
            <div class="form">
            <form action="/add_rev/{{product.id}}" method="post">
            {% csrf_token %}
            Ваша оценка:<input type="number" step="0.01" name="rate" min="0" max="5" placeholder="0-5"> <br>
            <textarea name="text" cols="30" rows="3" placeholder="Пишите отзыв здесь!"></textarea> <br>
            <input type="submit" value="Отправить">
            </form>
            </div>
            {% else %}
            <div class="form">
                Чтобы оставить отзыв, зарегистрируйтесь!
            </div>
            {% endif %}
        </div>
       
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    $(document).ready(function () {
        $('.thumb a').mouseover(function (e) {
            e.preventDefault();
            $('.imgBox img').attr("src", $(this).attr("href"));
        });
        $('.thumb a').click(function (e) {
            e.preventDefault();
            $('.imgBox img').attr("src", $(this).attr("href"));
        });
    });
</script>
<script>
    function openTab(tab){
        if (tab === 'reviews'){
            
            document.getElementById("product").style.display = "none";
            document.getElementById("reviews").style.display = "block";

        }
        if (tab === 'product'){
            
            document.getElementById("reviews").style.display = "none";
            document.getElementById("product").style.display = "block";

        }
    }
</script>
{% endblock %}